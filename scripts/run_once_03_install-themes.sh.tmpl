#!/bin/bash
# Install GTK themes, icon themes, and cursors.

set -euo pipefail

# Prerequisite: gtk-engine-murrine
if ! pacman -Q gtk-engine-murrine &>/dev/null; then
  echo "üîç gtk-engine-murrine not found, installing..."
  paru -S --noconfirm --needed gtk-engine-murrine
  if [ $? -ne 0 ]; then
    echo "‚ùå Failed to install gtk-engine-murrine. Exiting script, chezmoi apply will continue."
    exit 0
  fi
else
  echo "‚úÖ gtk-engine-murrine is already installed."
fi

# Setting up GTK themes
echo "üé® Cloning Catppuccin-GTK-Theme..."
git clone https://github.com/Fausto-Korpsvart/Catppuccin-GTK-Theme.git
if [ $? -ne 0 ]; then
  echo "‚ùå Failed to clone Catppuccin-GTK-Theme. Exiting script, chezmoi apply will continue."
  exit 0
fi
cd ./Catppuccin-GTK-Theme/themes
echo "üõ†Ô∏è Installing Catppuccin GTK theme..."
./install.sh --tweaks macchiato macos outline float black -t mauve -l -s compact
if [ $? -ne 0 ]; then
  echo "‚ùå Failed to install Catppuccin GTK theme. Exiting script, chezmoi apply will continue."
  exit 0
fi
cd ../..
rm -rf Catppuccin-GTK-Theme

# Setting up icon themes and cursors
echo "üé® Cloning Colloid-icon-theme..."
git clone https://github.com/vinceliuice/Colloid-icon-theme.git
if [ $? -ne 0 ]; then
  echo "‚ùå Failed to clone Colloid-icon-theme. Exiting script, chezmoi apply will continue."
  exit 0
fi
cd ./Colloid-icon-theme
echo "üõ†Ô∏è Installing Colloid icon theme..."
./install.sh -s catppuccin -t purple
if [ $? -ne 0 ]; then
  echo "‚ùå Failed to install Colloid icon theme. Exiting script, chezmoi apply will continue."
  exit 0
fi
cd cursors
echo "üñ±Ô∏è Installing Colloid cursors..."
./install.sh
if [ $? -ne 0 ]; then
  echo "‚ùå Failed to install Colloid cursors. Exiting script, chezmoi apply will continue."
  exit 0
fi
cd ../..
rm -rf Colloid-icon-theme

# Coping themes to root-owned directories if necessary
if [ -d "/usr/share/themes" ] && [ -d "/usr/share/icons" ]; then
  echo "üîß Copying themes and icons to /usr/share/..."
  sudo cp -rf ~/.themes/* /usr/share/themes/
  sudo cp -rf ~/.local/share/icons/* /usr/share/icons/
  if [ $? -ne 0 ]; then
    echo "‚ùå Failed to copy themes or icons to /usr/share/. Exiting script, chezmoi apply will continue."
    exit 0
  fi
else
  echo "‚ö†Ô∏è /usr/share/themes or /usr/share/icons does not exist. Skipping copy step."
fi

# End of script
