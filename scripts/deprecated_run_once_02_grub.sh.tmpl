#!/bin/bash
# This script sets up the boot screen with GRUB themes.

set -eufo pipefail

# Installing GRUB themes
# Download catppuccin-macchiato-grub-theme-git from AUR if not already installed
if ! pacman -Q catppuccin-macchiato-grub-theme-git &>/dev/null; then
  echo "üîç catppuccin-macchiato GRUB theme not found, installing..."
  paru -S --noconfirm --needed catppuccin-macchiato-grub-theme-git
  if [ $? -ne 0 ]; then
    echo "‚ùå Failed to install catppuccin-macchiato GRUB theme. Exiting script, chezmoi apply will continue."
    exit 0
  fi
else
  echo "‚úÖ catppuccin-macchiato GRUB theme is already installed."
fi
# Set GRUB theme to catppuccin-macchiato
# Check if the theme is already set
if ! grep -q 'GRUB_THEME="/usr/share/grub/themes/catppuccin-macchiato/theme.txt"' /etc/default/grub; then
  echo "üé® Setting GRUB theme to catppuccin-macchiato..."
  # Remove existing GRUB_THEME line if it exists
  sudo sed -i '/^GRUB_THEME=/d' /etc/default/grub
  # Add the new GRUB_THEME line
  echo 'GRUB_THEME="/usr/share/grub/themes/catppuccin-macchiato/theme.txt"' | sudo tee -a /etc/default/grub
  if [ $? -ne 0 ]; then
    echo "‚ùå Failed to set GRUB theme. Exiting script, chezmoi apply will continue."
    exit 0
  fi
else
  echo "‚úÖ GRUB theme is already set to catppuccin-macchiato."
fi
