#!/bin/bash
# Install Hyprland and nwg-shell configuration

set -euo pipefail

# Install Hyprland and dependencies
echo "üîÑ Installing Hyprland and dependencies..."
paru -S --noconfirm --needed hyprland uwsm nwg-shell nwg-dock-hyprland nwg-bar xdg-desktop-portal-gtk xdg-desktop-portal-hyprland blueman batsignal
nwg-shell-installer -r
if [ $? -ne 0 ]; then
  echo "‚ùå Failed to install Hyprland and dependencies. Exiting script, chezmoi apply will continue."
  exit 0
fi
echo "‚úÖ Hyprland and dependencies installed successfully."

# Enable user systemd services (batsignal)
echo "üîß Configuring user systemd services..."
if command -v systemctl >/dev/null 2>&1; then
  systemctl --user daemon-reload || true

  if systemctl --user cat batsignal.service >/dev/null 2>&1; then
    echo "‚û°Ô∏è  Enabling and starting batsignal.service (user)..."
    systemctl --user enable --now batsignal.service || true
  else
    echo "‚ÑπÔ∏è  batsignal.service not found, skipping enable."
  fi
else
  echo "‚ö†Ô∏è  systemctl not available, skipping user service enable."
fi

echo "‚úÖ User systemd services configured."

# End of script
